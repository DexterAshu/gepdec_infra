<div class="content-wrapper">
  <div class="row">
    <div class="col-md-12 grid-margin">
      <div class="d-flex justify-content-between flex-wrap">
        <div class="d-flex align-items-end flex-wrap">
          <div class="mr-md-3 mr-xl-5">
            <h4 class="page-title" onclick="goBack()"><i class="mdi mdi-chevron-left mdi-2"></i>BOQ Items</h4>
          </div>
        </div>
        <div class="d-flex justify-content-between align-items-end flex-wrap"></div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body">
          <div class="d-flex my-10">
            <div class="col-lg-4">
              <input type="search" class="form-control form-control-sm" [(ngModel)]="searchText" placeholder="Search">
            </div>
            <div class="col-lg-2">
            </div>
            <div class="col-lg-6">
              <div class="float-right">
                <button class="btn btn-primary btn-fw btn-sm me-2" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false"><span class="mdi mdi-upload"></span>&nbsp;Export</button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                  <li (click)="download()">
                    <a class="dropdown-item text-small cursor-pointer"><span class="mdi mdi-arrow-down-bold-box-outline"></span>Export Data</a>
                  </li>
                  <li>
                    <a class="dropdown-item text-small cursor-pointer" href="../../../../assets/tamplate/BOQ.xlsx" download="BOQ_upload_template.xlsx"><span class="mdi mdi-download"></span>Download&nbsp;Template</a>
                  </li>
                </ul>
                <button class="btn btn-primary btn-fw btn-sm me-2" data-bs-toggle="modal" data-bs-target="#createBulkModal" title="Upload bulk Data"><span class="mdi mdi-download"></span>&nbsp; Import</button>
              </div>
            </div>
          </div>
          <app-responsive-table id="export">
            <thead class="table-primary text-nowrap">
              <tr>
                <th>S No</th>
                <th>BOQ Code</th>
                <th>Client</th>
                <th>Tender Title</th>
                <th>Ref. No</th>
                <th>published Date</th>
                <th>Category</th>
                <th>Sub Category</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody class="text-nowrap">
              <tr *ngFor="let a of boqData | filter: searchText| paginate: { itemsPerPage: limit, currentPage: p }; index as i">
                <td>{{ limit*(p-1)+i+1 }}</td>
                <td>{{ a.boq_code }}</td>
                <td>{{ a.company_name}}</td>
                <td>
                  <div *ngIf="!!a.tender_title; else elseBlock" data-toggle="tooltip" data-placement="bottom" title="{{ a.tender_title }}">{{a.tender_title | slice:0:30}} <span *ngIf="a.tender_title.length > 30">...<i class="mdi mdi-information"></i></span></div>
                  <ng-template #elseBlock>{{a.tender_title}}</ng-template>
                </td>
                <td>{{ a.tender_ref_no}}</td>
                <td>{{ a.publish_date | date:'dd/MM/yyyy' }}</td>
                <td>{{ a.itemCategory }}</td>
                <td>{{ a.itemSubCategory }}</td>
                <td>{{ a.status }}</td>
                <td>
                  <a class="" data-bs-toggle="modal" data-bs-target="#detailModal" title="View Details" (click)="getBOQItemList(a)"><span class="mdi mdi-eye text-success cursor-pointer mdi-18px"></span></a>
                  <!-- <a data-bs-toggle="modal" data-bs-target="#allDataModal" title="Delete Details" ><span class="mdi mdi-delete-circle text-danger cursor-pointer mdi-18px"></span></a> -->
                </td>
              </tr>
              <tr *ngIf="isNotFound == true">
                <td colspan="15" class="text-center">
                  <div class="text-warning fw-semibold">Looks like no data available!</div>
                </td>
              </tr>
              <tr *ngIf="boqData?.length == 0">
                <td colspan="15" class="text-center">
                  <div class="spinner-border"></div>
                </td>
              </tr>
            </tbody>
          </app-responsive-table>
          <div class="pagination-sec text-center">
            <pagination-controls (pageChange)="p = $event"></pagination-controls>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">BOQ Items Information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <ng-container formArrayName="childItem">
              <div class="row" *ngFor="let quantity of boqChildItem().controls; let i=index" [formGroupName]="i">
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="form-label fl-10">Item<span class="required-asterisk">*</span></label>
                    <select formControlName="itemCode" class="form-select form-select-sm">
                      <option [selected]="true" [disabled]="true" [value]="null">Select Items</option>
                      <option *ngFor="let s of itemList?.items" value="{{s.item_id}}">{{ s.description }}</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-group">
                    <label class="form-label fl-10">Item Type<span class="required-asterisk">*</span></label>
                    <select formControlName="type" class="form-select form-select-sm">
                      <option [selected]="true" [disabled]="true" [value]="null">Item Type</option>
                      <option *ngFor="let s of dataDropdownList" value="{{s.itemtype_id}}">{{ s.itemtype }}</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="form-group">
                    <label class="form-label fl-10">Quantity<span class="required-asterisk">*</span></label>
                    <input formControlName="quantity" type="text" class="form-control form-control-sm" appNumberOnly>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label class="form-label fl-10">Is Children Item<span class="required-asterisk">*</span> </label>
                    <div class="row">
                      <label class="col-md-6 fl-10">
                        <input type="radio" formControlName="isChild" value="true"> &nbsp;&nbsp; Yes
                      </label>
                      <label class="col-md-6 fl-10">
                        <input type="radio" formControlName="isChild" value="false"> &nbsp;&nbsp; No
                      </label>
                    </div>
                  </div>
                </div>
                <div class="col-md-10">
                  <div class="form-group">
                    <ng-multiselect-dropdown name="addmember" [placeholder]="'Select Member'" [data]="dataDropdownList" [(ngModel)]="selectedItems" formControlName="childItem" [settings]="dropdownSettings" (onSelect)="onItemSelect($event)" (onDeSelect)="onItemDeSelect($event)" (onSelectAll)="onSelectAll($event)"></ng-multiselect-dropdown>
                  </div>
                </div>
                <div class="col-md-1">
                  <button *ngIf="i > 0" type="button" (click)="removeRow(i, 'contactDetails')" class="btn btn-secondary btn-fw btn-sm float-right ml-2 p-2"><span class="mdi mdi-close"></span></button>
                </div>
                <div class="col-md-1">
                  <span type="button" (click)="addAnotherRow()" class="mt-3 text-light bg-success float-right p-1 rounded-circle" title="Click to add more bank details"><span class="mdi mdi-plus"></span></span>
                </div>
              </div>
            </ng-container>
            <div class="modal-btns mt-2">
              <button type="submit" *ngIf="!isSubmitted" [disabled]="!form.valid" class="btn btn-primary btn-fw btn-sm mr-2">{{button}}</button>
              <button type="button" *ngIf="isSubmitted" disabled class="btn btn-primary btn-fw btn-sm mr-2"><span class="spinner-border spinner-border-sm" aria-hidden="true"></span> Adding...</button>
              <!-- <button type="button" id="cancel" class="btn btn-secondary btn-fw btn-sm" data-bs-dismiss="modal">Close</button> -->
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="createBulkModal" tabindex="-1" aria-labelledby="bulkModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">BOQ Items Bulk Data</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <form [formGroup]="form1" (ngSubmit)="onBOQSubmit()">
            <div class="row">
              <div class="col-md-3">
                <div class="form-group">
                  <label class="form-label fl-10">Client<span class="required-asterisk">*</span></label>
                  <select formControlName="utility_id" class="form-select form-select-sm" (ngModelChange)="getDetails($event)">
                    <option [selected]="true" [disabled]="true" [value]="null">Select Client Company</option>
                    <option *ngFor="let c of comData" value="{{c.company_id}}">{{ c.company_name }}</option>
                  </select>
                  <div *ngIf="fb['utility_id'].touched && fb['utility_id'].invalid">
                    <small class="text-danger" *ngIf="fb['utility_id'].errors?.['required']">*Required</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label class="form-label fl-10">Tender Title<span class="required-asterisk">*</span></label>
                  <select formControlName="tender_id" class="form-select form-select-sm" (ngModelChange)="getrefData($event)">
                    <option [selected]="true" [disabled]="true">Select Project</option>
                    <option *ngFor="let c of tenderDetailsData" value="{{c.tender_id}}">{{c.tender_title}}</option>
                  </select>
                  <div *ngIf="fb['tender_id'].touched && fb['tender_id'].invalid">
                    <small class="text-danger" *ngIf="fb['tender_id'].errors?.['required']">*Required</small>
                  </div>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label class="form-label fl-10">Ref No</label>
                  <span class="form-control form-control-sm" readonly>{{filterTenderDetailsData[0]?.tender_ref_no}}</span>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label class="form-label fl-10">Publish Date</label>
                  <span class="form-control form-control-sm" readonly>{{filterTenderDetailsData[0]?.publish_date | date:'dd/MM/yyyy'}}</span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-label">Category<span class="required-asterisk">*</span></label>
                  <select formControlName="itemCategory" class="form-select form-select-sm">
                    <option [selected]="true" [disabled]="true" [value]="null">Select Category</option>
                    <option *ngFor="let t of dataCatList" [value]="t.itemcategory_id">{{ t.itemcategory }}</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label class="form-label">Sub-Category<span class="required-asterisk">*</span></label>
                  <select formControlName="itemSubCategory" class="form-select form-select-sm">
                    <option [selected]="true" [disabled]="true" [value]="null">Select Sub-category</option>
                    <option *ngFor="let t of dataSubList" [value]="t.subcategory_id">{{ t.subcategory }}</option>
                  </select>
                </div>
              </div>
              <div class="col-md-12 mt-1">
                <label class="form-label fl-10">Please ensure your file is named 'BOQ_sample_template' <span class="required-asterisk">*</span>
                </label><br>
                <input class="mt-2" type="file" formControlName="attachment" (change)="onFileChanged($event)" accept=".xlsx, .xls" />
                <br>
                <div class="float-right mt-2">
                  <button type="submit" *ngIf="!isSubmitted" class="btn btn-primary btn-fw btn-sm me-2" [disabled]="form1.invalid"> Upload</button>
                  <button type="button" *ngIf="isSubmitted" disabled class="btn btn-primary btn-fw btn-sm mr-2"><span class="spinner-border spinner-border-sm" aria-hidden="true"></span>Uploading...</button>
                  <button type="button" id="cancel" class="btn btn-secondary btn-fw btn-sm" data-bs-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="true">
  <div class="modal-dialog modal-dialog-centered modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">BOQ Item Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-3">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-12 p-0">
              <div class="table-responsive">
                <table class="table table-hover table-striped custom-table">
                  <thead class="table-primary text-nowrap">
                    <tr>
                      <th colspan="6" class="text-center">Tender Information</th>
                    </tr>
                  </thead>
                  <tbody class="text-nowrap">
                    <tr>
                      <th>Client</th>
                      <td>{{ itemList?.company_name }}</td>
                      <th>Tender Ref. No.</th>
                      <td>{{ itemList?.tender_ref_no }}</td>
                      <th>Tender Title</th>
                      <td data-toggle="tooltip" data-placement="bottom" title="{{ itemList.tender_title }}">{{itemList.tender_title| slice:0:30}} <span>...<i class="mdi mdi-information"></i></span></td>
                    </tr>
                    <tr>
                      <th>Execution Location</th>
                      <td>{{ itemList?.tender_location }}</td>
                      <th>Published Date</th>
                      <td>{{ itemList?.publish_date | date:'dd/MM/yyyy' }}</td>
                      <th>BOQ Code</th>
                      <td>{{ itemList?.boq_code }}</td>
                    </tr>
                  </tbody>
                </table>
                <app-responsive-table class="mt-1">
                  <thead class="table-primary text-nowrap">
                    <tr>
                      <th>S No</th>
                      <th>Item Code</th>
                      <th>Description</th>
                      <th>Basic Value</th>
                      <th>Unit Price</th>
                      <th>Quantity</th>
                    </tr>
                  </thead>
                  <tbody class="text-nowrap">
                    <tr *ngFor="let item of itemList?.items; index as i">
                      <td>{{ limit*(p-1)+i+1 }}</td>
                      <td>{{ item?.itemcode }}</td>
                      <td>{{ item?.description }}</td>
                      <td>{{ item?.basic_value }}</td>
                      <td>{{ item?.unit_price }}</td>
                      <td>{{ item?.qty }}</td>
                    </tr>
                    <tr *ngIf="isNotFound == true">
                      <td colspan="15" class="text-center">
                        <div class="spinner-border"> </div>
                      </td>
                    </tr>
                    <tr *ngIf="rowData?.data?.length == 0">
                      <td colspan="15" class="text-center">
                        <div class="text-warning fw-semibold">Looks like no data available!</div>
                      </td>
                    </tr>
                  </tbody>
                </app-responsive-table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
